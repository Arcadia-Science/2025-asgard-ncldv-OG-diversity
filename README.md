# 2025-Asgard-NCLDV-OG-Diversity

# Purpose

This repository contains the scripts and analysis notebooks used to investigate the relationship between sequence diversity and structural diversity within orthologous groups (OGs) from Asgard archaea. The primary motivation was to determined whether we could find global rules to characterize the relationship of protein sequence and structure in Asgard archaea proteomes, representing ~2 billion years of evolution. We found no correlation between structural and phylogenetic diversity, and only weak correlations between sequence and structural diversity. Instead, we found that the subset of orthogroups with the least structural diversity comprise protein families where the structure is effectively resistent to sequence divergence. We

# Installation and Setup

This repository uses conda to manage software environments and installations. You can find operating system-specific instructions for installing miniconda here. 

After installing conda and mamba, run the following command to create the environment used for most analyses.# Environment used for data processing and analysis notebooks
    mamba env create -n asgard_gv_env --file envs/dev.yml
    conda activate asgard_gv_env
    (Note: The envs/dev.yml file will need to be created based on the packages used, e.g., pandas, numpy, plotly, biopython, scipy, statsmodels, arcadia-pycolor, etc.)
    1. Install your pre-commit hooks:pre-commit install


# Data

# Input Data:
proteome_database_v3.5.csv: The primary input database containing protein sequences, OG assignments, and pre-computed annotations (domain counts, disorder, etc.) for Asgard archaea. Generated in a prior study (DOI: xxx)

interpro_entry.txt: Reference file from InterPro for mapping IPR domain IDs to human-readable names.

downloaded_structures/: A directory containing pre-downloaded protein structures from the AlphaFold DB and RCSB PDB, organized into alphafold_structures/ and rcsb_pdb/ subdirectories. Available on zenodo

# Intermediate Data:
analysis_v3/final_master_og_properties_v2.csv: The primary integrated data table generated by the analysis notebooks, containing merged sequence, structural, and phylogenetic diversity metrics for each OG.

analysis_v3/all_vs_all_structural_metrics.csv: The raw output of the all-vs-all TM-align comparisons, containing pairwise TM-scores and RMSD values.

analysis_v3/og_sequence_diversity_v3.csv: Table of sequence-based diversity metrics (Hill Diversity, APSI, Shannon Entropy) for each OG.

analysis_v3/generated_data/df_per_column_conservation.csv: Per-column Shannon entropy values for each position in the MSA of each OG.

# Primary Output Data:
publication_figures/: Directory containing all final, publication-quality figures and statistical summary tables generated by the main analysis notebook.


# Overview

# Description of the Folder Structure

scripts/: Contains all Python scripts for the data processing pipeline (OG selection, MSA, tree building, diversity calculation, etc.).

notebooks/: Contains Jupyter notebooks (Analysis_v3.ipynb and pub_figures.ipynb) for exploratory data analysis and final figure generation.

data/: Contains raw and intermediate data files.

results/: Contains the primary data outputs from the analysis pipeline and notebooks.

publication_figures/: Contains the final, publication-ready figures.

envs/: Contains the conda environment definition file.

# Methods

The analysis was conducted via a multi-step pipeline executed through a series of Python scripts and Jupyter Notebooks.

1. OG selection and sequence extraction: From the existing Asgard archaea proteome database (proteome_database_v3.5.csv) we identified all Asgard orthogroups with >20 members (prepare_og_list.py) and extracted all amino acid sequences from those orthogroups into a single FASTA (extract_og_sequences.py)

2. Sequence & Phylogenetic Diversity Calculation: For each OG, sequences were aligned with MAFFT (run_initial_mafft_parallel.py) and filtered (filter_mafft_alignments_by_length.py). Length-filtered alignments were then un-aligned and realigned (refine_alignments.py) Phylogenetic trees were inferred from the final alignments using VeryFastTree (run_fasttree_parallel.py). Sequence diversity was quantified from the alignments (Average Pairwise Sequence Identity) and trees (Normalized Hill Diversity) using hill_diversity_v3.py.

3. Structural Diversity Calculation: We used TM-align to do a comprehensive all-vs-all structural comparison  for all members within each OG that had an available structure. The resulting pairwise TM-scores were aggregated to calculate the mean (Mean_TMscore) and standard deviation (StdDev_TMscore) for each OG.

4. Data Integration and Analysis: All computed metrics were merged into a master dataframe. OGs were categorized into "Structurally Rigid," "Structurally Plastic," and "Intermediate" profiles based on the 25th and 75th percentiles of their Mean_TMscore and StdDev_TMscore. Open-ended exploration of these data was conducted in the Analysis_V3 notebook.

5. Hypothesis Testing & Visualization: The final analysis, performed in a dedicated Jupyter Notebook (pub_figures.ipynb), tested several hypotheses:

a. The global correlation between sequence diversity (both Hill Diversity and APSI) and structural diversity  was assessed.

b. The distributions of domain count and intrinsic disorder were compared across structural profiles using KDE plots.

c. The relationship between sequence and structure was explored within specific functional families defined by their consensus domain architecture using faceted correlation plots.

d. Per-column Shannon entropy was analyzed to compare conservation patterns between structural profiles, leading to the "islands of conservation" hypothesis.

# Compute Specifications
Local Machine: Apple MacBook Pro M3 Max, 36 GB RAM (Used for scripting, data integration, statistical analysis, and figure generation).

AWS EC2: Used for the all-vs-all TM-align. Amazon Linux2 c6a32X large with 128 CPUs. 

Key Software: Python 3.10 (via Conda/Mamba), Pandas, NumPy, SciPy, Statsmodels, Plotly, arcadia-pycolor, BioPython, MAFFT, FastTree, TM-align.

# For Developers
This section contains information for developers who are working off of this template. Please adjust or edit this section as appropriate when you're ready to share your repo.

# GitHub templates
This template uses GitHub templates to provide checklists when making new pull requests. These templates are stored in the .github/ directory.

.gitignore
This template uses a .gitignore file to prevent certain files from being committed to the repository.

pyproject.toml
pyproject.toml is a configuration file to specify your project's metadata and to set the behavior of other tools such as linters, type checkers etc. You can learn more here

Linting
This template automates linting and formatting using GitHub Actions and the ruff linter. When you push changes to your repository, GitHub will automatically run the linter and report any errors, blocking merges until they are resolved.

